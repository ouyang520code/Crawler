import{_ as U,I as Y}from"./idl-d4f3a80c.js";import{w as n,e as l,a as T,B as h,s as x,h as O,P as Q,b as L,D as q,i as H,E as Z,f,j as J,c as G,A as X,S as j,k as $,d as ee,$ as te}from"./apis-e000dd75.js";import{d as ae,r as s,o as ne,a as oe,b as se,e as re,f as a,g as R,t as A,h as le,P as i,S as K,T as ie,j as ce,_ as ue}from"./index-de3d961b.js";const de="/assets/zhuan1-1bbb1fb6.png",me="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFYAAABzCAYAAAACN/VyAAAAAXNSR0IArs4c6QAABQxJREFUeF7t3T/MJVMYx/HvQ0TQKTRKNtnCFmsrjT/LRiRbCVn75+UlUUhEFIQoJCoJEWE7sizWEkIkQkQUQrEFIv6ERoVCIgQFibCP+7jn3b3vNWfOzJmZRe5vkrebmXvP533mOec8M3eOMdHm7tuBh4EdwK/A28BdZvbDRB/Zelp3vw14BDgL+BJ4CnjUzP6c4vvYFCd1963AR8DZS+f/JKCnakyuLe6+E3gHWG7vi8B+Mzs+tsNUsAeB2zNfdpeZRSNP2ebuLwHXZz5wEtypYF8HdmcacqeZPXbKVAF3j6vn4pbPfAFYG/NKmgr2TeCaTEPuMbOHTjHsZ8BFhc+MyD0wFq5gN2u/DOwdA1ew/wzjUXAF25wfBuMKNp94B+EKtr1Hq8YVbHl4UoUr2DJs7NEbd1VgPwW2ZQzfAq5umO4u794LV7CwL9U0ngBOKwRwZ9xVgW2beUUR5qi7rwOHxsIV7Ly6dTQitSfuPjP7Ixfhgl2A7Yn76qyuuyeHK9gl2IR7I/B0h7SQxRVsA2zCXQMO1+IKNgM7FFewLbALuJEWTi8MxTalBcEWYBNujHWf7YO7KrBtM68Tw622iHT3AynnliL3sJndvCqwxQlCl5KBu3eN3EtWBXZwxG7Au/te4LlCWrhPsB1y7HI0u/se4PkW3FsFWwGbOrQbgCMNuD/N0LcIthI24V4LPAmcm6L6mzTNPSbYAbAJ90zgSuA34L2NW+erAjvKqKDLyGFjH8EOjFiVDfOPGHWaIPSJ1thXEauI7RszJ/d3d+XYer78kYKdQnV+L0sRO4WtYKdQVcROpCpYwRYF3P3/9BsETRCK/9HMDuq8auUKxwlWsO0CyrEqwkSEqPOqzRTKsbVy6rz+Fviv/ZZWqaA2oJUKauWUCpQKBsWOxrEax2ocO+QSUuc1RK/lWMEKVkWYUgzoSRgVYUoxogc2VCuojRFNEDRB0ASh9uqJ4zSOHaKnCYIK3dXxo85LnZc6r+rLR53XELpi7UJPdE/Bq+HWFKpKBROpClawRQGNYzWO1Ti2eJmoVqBaQXWQKMcqxyrHVl8+GscOoVOtIAR0l7Y2htR5qfNS51V79fzrd2nd/bK0/N13wBtm9kttY5QKwNw9Vqt4Jpa1W4D8OpbmM7MvanAFO4e9e7YkSNMaht/P3tW308w+74sr2DnsV7MXzV6QwYvFeS/viyvYOezvwBktUdkbV7Bz2G9n70A9v3C5B+4VZhZ3O4ubYOewDwL3FrUgcCPnxvuuWzfBnhwVxDv+95fAgB+Bq8zs47Z9BZtmXmnINRquYBemtGPiCnapVtATN96eHmkhFizftAm2oQgzBq5gM9WtobiCbSkb9sT9GdhlZh+kapJewVcYNkWBputo4QSuIrZDobsmcmcvVX8gqmOZf5puzWzAJNxYhS0WaSxtEblRGbtQsCWq+S3k+EFzLM7YBbftjIrYhvHpGLiCbQq7ESJXsLnreSCuYAtDsdq0INhSn1YZuYItwaZZVt/IFWwX2ApcwXaFXZhIxDj3psJxd5jZwb7nHrK/u38I7Mic4zoze2XI+ZuOHfUtRmmGdghYb/micVPy3bEbUuho44GU3MRmi5nFIwCjbqPCLkRu4N7S8E3fN7NLR21Bh5O5+zbgGHDO0u5HzGytwyl67zIJbMq7u4H42w6cB8QNyPUhz4T1bt3CAe6+FbgfCOS44/zabNnTx83s+JDz5o79C3QwRtw1HKZtAAAAAElFTkSuQmCC",fe="/assets/num-63e15688.png",Ae={class:"pool"},ge={class:"inpt"},pe={class:"info"},we={style:{"margin-left":"10px"}},ve={class:"synthesis"},be={class:"left"},Te={class:"left_btn"},ye={class:"right"},Be={class:"num"},Ne={class:"sui"},_e={class:"inpt_bi"},Ie=ae({__name:"index",setup(Ee){const _=s(""),c=s(""),I=s(!1),y=s(""),g=s(0),u=s(""),p=s(0),w=s(null),v=s(0),M=s(!1),E=s(""),C=async()=>{var t;try{if(!((t=n.wallet)!=null&&t.publicKey))return;g.value=await n.getTokenBalance(n.wallet.publicKey,l)}catch(e){console.error("Error updating token balance:",e),g.value=0}},k=async()=>{if(c.value==0||c.value=="")return T("请输入兑换数量");const t=new h(100*c.value);try{if(!n.wallet&&(await n.connectWallet(),!n.wallet))throw new Error("请先连接钱包");I.value=!0,x({message:"正在 Mint NFT...",forbidClick:!0});const e=n.getProvider(n.wallet);if(!e)throw new Error("未找到钱包提供者");const d=await n.getUserTokenAccount(l),m=await n.getUserTokenAccount(O),r=new Q(Y,L,e),[B]=i.findProgramAddressSync([Buffer.from(q),e.wallet.publicKey.toBuffer()],r.programId),[N]=i.findProgramAddressSync([Buffer.from("adminGlobal")],r.programId);console.log("adminPDA",N.toString());try{const o=await r.account.admin.fetch(N);console.log("PDA Account Data:",JSON.stringify(o,null,2)),E.value=JSON.parse(JSON.stringify(o,null,2)).editionNumber}catch(o){console.log("PDA account data not found or error:",o)}const[V]=i.findProgramAddressSync([Buffer.from(H)],r.programId),[F]=i.findProgramAddressSync([Buffer.from(Z)],r.programId);await n.getConnection().getAccountInfo(B)||[].push(await r.methods.initUserData().accounts({user:e.wallet.publicKey,pdaAccount:B,systemProgram:K.programId}).instruction());try{const[o]=i.findProgramAddressSync([Buffer.from("metadata"),f.toBuffer(),l.toBuffer()],f),[z]=i.findProgramAddressSync([Buffer.from("metadata"),f.toBuffer(),l.toBuffer(),Buffer.from("edition")],f),W=await r.methods.mintNft(new h(E.value),t).accounts({pdaAccount:B,metaplexTokenMetadata:f,editionMetadata:o,edition:z,editionMint:l,editionTokenAccountOwner:e.wallet.publicKey,editionTokenAccount:d.address,editionMintAuthority:e.wallet.publicKey,masterEdition:l,editionMarkerPda:F,payer:e.wallet.publicKey,masterTokenAccountOwner:e.wallet.publicKey,masterTokenAccount:d.address,masterMetadata:J,updateAuthority:V,splTokenProgram:G,splAtaProgram:X,sysvarInstructions:j,systemProgram:K.programId,tokenMint:O,userTokenAccount:m.address,adminData:N}).instruction(),b=new ie;b.add(W),b.recentBlockhash=(await n.getConnection().getLatestBlockhash()).blockhash,b.feePayer=e.wallet.publicKey;const P=await e.wallet.signTransaction(b);console.log("Transaction Signature",P),y.value=`Mint NFT 成功！交易ID: ${P}`,$("Mint NFT 成功！"),S()}catch(o){console.error("Mint NFT error:",o),o instanceof Error?(y.value=`错误: ${o.message}`,T(o.message)):(y.value="发生未知错误",T("发生未知错误"))}}catch(e){console.error("Mint NFT error:",e),n.isUserRejection(e)||T(e instanceof Error?e.message:"Mint NFT 失败")}finally{I.value=!1,ee()}},D=async()=>{var t;if((t=w.value)!=null&&t.publicKey)try{u.value=w.value.publicKey.toString(),u.value.length>0&&S(),g.value=await n.getTokenBalance(w.value.publicKey)}catch(e){console.error("获取钱包信息失败:",e)}},S=()=>{te.getUserinfo({address:u.value}).then(t=>{t.code==200&&(console.log("res>>>用户信息",t),v.value=t.data.all_point,p.value=t.data.node_success)}).catch(t=>{console.log("err>>>用户信息",t)})};return ne(async()=>{try{const t=n.getPhantomWallet();t!=null&&t.isConnected&&(await t.disconnect(),await new Promise(e=>setTimeout(e,500))),await n.connectWallet(),await C()}catch(t){console.error("Wallet initialization error:",t)}n.setCallbacks({onConnect:async t=>{console.log("钱包已连接"),w.value=t,M.value=!0,await D()},onDisconnect:()=>{console.log("钱包已断开连接"),u.value="",p.value=0,v.value=0,g.value=0}}),n.initWalletListeners()}),oe(()=>{const t=n.getPhantomWallet();t!=null&&t.isConnected&&t.disconnect(),n.cleanup()}),(t,e)=>{const d=ce("van-field");return se(),re("div",Ae,[e[8]||(e[8]=a("div",{class:"biaoti"},"爬虫信息查询",-1)),a("div",ge,[R(d,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=m=>_.value=m),label:"","left-icon":"search",placeholder:"请输入....",center:"true"},null,8,["modelValue"]),e[2]||(e[2]=a("div",{class:"btn"},"确认",-1))]),a("div",pe,[a("span",null,"地址："+A(u.value),1),a("div",null,[le(" NFT："+A(p.value),1),a("span",we,A(p.value>0?"已产生":"未产生"),1)])]),a("div",ve,[a("div",be,[a("div",Te,[e[3]||(e[3]=a("img",{src:U,alt:""},null,-1)),a("span",null,A(v.value),1)])]),a("div",ye,[e[5]||(e[5]=a("img",{src:de,alt:""},null,-1)),a("div",Be,[a("span",Ne,A(v.value),1),e[4]||(e[4]=a("span",{class:"content"},"碎片数量",-1))]),a("div",_e,[R(d,{modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=m=>c.value=m),placeholder:"请输入代币输入合成数量",center:"true"},null,8,["modelValue"])]),e[6]||(e[6]=a("img",{src:me,alt:"",class:"huan"},null,-1)),e[7]||(e[7]=a("div",{class:"huo"},[a("img",{src:fe,alt:""}),a("span",null,"获得数量")],-1)),a("div",{class:"sure",onClick:k},"确认")])])])}}});const Ke=ue(Ie,[["__scopeId","data-v-d407a486"]]);export{Ke as default};
